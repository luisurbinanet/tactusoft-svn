<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/common.xhtml">

	<ui:define name="body">

		<p:panel style="width:1150px;height:600px;"
			header="#{msg['title_case_study']}">

			<p:spacer height="5" />

			<h:form id="form">

				<p:dataTable id="recordTable" var="rec"
					value="#{caseStudyBacking.model}" rowKey="#{rec.id}"
					resizableColumns="true" selection="#{caseStudyBacking.selected}"
					paginator="true" rows="10" style="width:100%"
					emptyMessage="#{msg['glb_no_records_found']}">

					<p:column selectionMode="single" style="width:18px" />

					<p:column headerText="#{msg['app_doctor']}">
						<h:outputLabel value="#{rec.crmAppointment.crmDoctor.names}" />
					</p:column>

					<p:column headerText="#{msg['cam_pat']}">
						<h:outputLabel value="#{rec.crmAppointment.crmPatient.names}" />
					</p:column>

					<p:column headerText="#{msg['cst_start_date']}">
						<h:outputLabel value="#{rec.startDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputLabel>
					</p:column>

					<p:column headerText="#{msg['cst_end_date']}">
						<h:outputLabel value="#{rec.crmAppointment.startAppointmentDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputLabel>
					</p:column>

					<p:column headerText="#{msg['cst_perc']}">
						<h:outputLabel value="#{rec.percent}" />
					</p:column>

					<p:column headerText="#{msg['cst_patology']}">
						<h:outputLabel value="#{rec.crmCie.description}" />
					</p:column>

					<p:column headerText="#{msg['cst_reason']}">
						<h:outputLabel value="#{rec.reason}" />
					</p:column>

				</p:dataTable>

			</h:form>

		</p:panel>

		<h:form id="editForm">

			<p:growl id="growl" showDetail="true" />

			<p:dialog header="#{msg['sal_patient']}" widgetVar="dlgPatient"
				resizable="false" id="dialogPatient" showEffect="fade"
				hideEffect="explode" modal="true" width="600">

				<h:panelGrid columns="2" width="100%">

					<p:outputPanel id="customPanel">
						<p:selectOneRadio id="customRadio"
							value="#{caseStudyBacking.optionSearchPatient}" layout="custom">
							<f:selectItem itemLabel="#{msg['sal_key_press_doc']}"
								itemValue="1" />
							<f:selectItem itemLabel="#{msg['sal_key_press_nom']}"
								itemValue="2" />
						</p:selectOneRadio>

						<h:panelGrid columns="2" width="100%" cellspacing="10">
							<h:outputText value="#{msg['usr_profile']}" />
							<p:selectOneMenu value="#{caseStudyBacking.idProfile}"
								style="width:500px" required="true"
								label="#{msg['usr_profile']}">
								<f:selectItems value="#{caseStudyBacking.listProfile}" />
							</p:selectOneMenu>
						</h:panelGrid>

						<h:panelGrid id="pnlTxt" columns="3" width="100%">
							<p:radioButton id="opt1" for="customRadio" itemIndex="0" />
							<h:outputLabel for="opt1" value="#{msg['sal_key_press_doc']}" />
							<p:inputText id="txtDoc" value="#{caseStudyBacking.docPatient}"
								style="width:100%" />

							<p:radioButton id="opt2" for="customRadio" itemIndex="1" />
							<h:outputLabel for="opt2" value="#{msg['sal_key_press_nom']}" />
							<p:inputText id="txtName" value="#{caseStudyBacking.namePatient}"
								style="width:100%" />

						</h:panelGrid>
					</p:outputPanel>

					<f:facet name="footer">
						<p:spacer height="10" />

						<p:commandButton value="#{msg['btn_search']}"
							icon="ui-icon-search"
							update="pnlTable2 recordTable2 btnAddPatient"
							process="@this,customPanel"
							action="#{caseStudyBacking.searchPatientAction}" />
						<p:commandButton id="btnAddPatient" value="#{msg['btn_add']}"
							icon="ui-icon-plusthick"
							oncomplete="handleComplete(xhr, status, args)"
							actionListener="#{caseStudyBacking.addPatient}"
							process="@this,dialogPatient"
							disabled="#{caseStudyBacking.disabledAddPatient}" />
					</f:facet>
				</h:panelGrid>

				<p:spacer height="10" />
				<p:scrollPanel id="pnlTable2" style="width:580px;height:300px">
					<p:dataTable id="recordTable2" var="rec"
						value="#{caseStudyBacking.patientModel}" rowKey="#{rec.id}"
						selection="#{caseStudyBacking.selectedPatientTemp}"
						paginator="true" rows="15" style="width:570px"
						emptyMessage="#{msg['glb_no_records_found']}">

						<p:column selectionMode="single" style="width:18px" />

						<p:column headerText="#{msg['pat_sap_code']}">
							<h:outputLabel value="#{rec.codeSap}" />
						</p:column>

						<p:column headerText="#{msg['pat_names']}">
							<h:outputLabel value="#{rec.names}" />
						</p:column>

					</p:dataTable>
				</p:scrollPanel>

			</p:dialog>
		</h:form>

		<script type="text/javascript">
			function handleComplete(xhr, status, args) {
				if (args.validate) {
					dlgPatient.hide();
				} else {
					dialogPatient.show();
				}
			}

			function handleComplete2(xhr, status, args) {
				if (args.validate) {
					dlg.hide();
				}
			}
		</script>

	</ui:define>
</ui:composition>
</html>
