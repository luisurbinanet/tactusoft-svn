<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../layout/main.xhtml">

	<ui:define name="content">

		<div class="rco-blockheader">
			<div class="l"></div>
			<div class="r"></div>
			<div class="t">#{msg['title_report_daymonth']}</div>
		</div>

		<div id="content2">
			<h:form id="form">

				<p:panel width="100%">
					<h:panelGrid id="pnlParameter" columns="2" width="100%">
						<h:outputText value="#{msg['wos_calendar_week']}"
							style="width:100%" />
						<p:selectOneMenu value="#{reportBacking.idKpiWeek}"
							style="width:430px">
							<f:selectItems value="#{reportBacking.listItemWeeks}" />
						</p:selectOneMenu>
					</h:panelGrid>

					<f:facet name="footer">
						<p:commandButton id="cmdOK" update="recordTable panel"
							value="#{msg['btn_ok']}"
							actionListener="#{reportBacking.generateAction}">
						</p:commandButton>
					</f:facet>

				</p:panel>

				<p:spacer height="10" />

				<h:panelGrid id="display" width="100%">
					<p:dataTable id="recordTable" var="rec"
						value="#{reportBacking.model}">

						<p:column headerText="Daily Metrics">
							<h:outputLabel value="#{rec.metric}" />
						</p:column>

						<p:column headerText="UM">
							<h:outputLabel value="#{rec.um}" />
						</p:column>

						<p:column headerText="">
							<h:outputLabel value="#{rec.type}" />
						</p:column>

						<p:columns value="#{reportBacking.columns}" var="column"
							columnIndexVar="colIndex">

							<f:facet name="header">
                				#{column.header}
            				</f:facet>

							<h:outputLabel value="#{rec.listPlan[colIndex]}"
								rendered="#{rec.um eq '%'?true:false}"
								styleClass="#{rec.style[colIndex]}">
								<f:convertNumber type="percent" />
							</h:outputLabel>

							<h:outputLabel value="#{rec.listPlan[colIndex]}"
								rendered="#{rec.um eq '%'?false:true}"
								styleClass="#{rec.style[colIndex]}">
								<f:convertNumber type="number" />
							</h:outputLabel>

						</p:columns>

					</p:dataTable>

					<p:spacer height="10" />

					<p:outputPanel style="display:block;width: 100%; height: 450px;"
						id="chart_div" />

				</h:panelGrid>

				<h:panelGrid id="panel">
					<script type="text/javascript">
					if(loaded)
					{
						chartData = new google.visualization.DataTable(#{reportBacking.graphData});
						chartData.addRows(6);
						chartData.addColumn('string', 'codigo');
						chartData.addColumn('number', 'Demoras');
						chartData.addColumn('number', 'Promedio');
						
						var rowIndex = 0;
						var list = jQuery.parseJSON('#{reportBacking.graphData}');
						$.each(list, function(id, row) {
							chartData.setValue(rowIndex,0,row.label);
							chartData.setValue(rowIndex,1,row.value);
							chartData.setValue(rowIndex,2,row.avg);
							rowIndex++;
						});

						var formatter = new google.visualization.NumberFormat(
							      {pattern:'#,###%'});
						formatter.format(chartData, 2); // Apply formatter to second column

						chart.draw(chartData, chartOptions);
					}
					</script>
				</h:panelGrid>

			</h:form>

		</div>

		<script type="text/javascript">
			loaded=false;
			google.setOnLoadCallback(drawChart);

			// Callback that creates and populates a data table, 
			// instantiates the pie chart, passes in the data and
			// draws it.

			function drawChart() {
				loaded=true;
				
				// Create our data table.
				chartData = new google.visualization.DataTable();
				
				chartData.addColumn('string', 'codigo');
				chartData.addColumn('number', 'Demoras');
				chartData.addColumn('number', 'Promedio');

				chartOptions = {
	                    title : 'Demoras del Dia Anterior',
	                    vAxis: {title: "Horas"},
	                    hAxis: {title: ""},
	                    seriesType: "bars",
	                    series:{1:{type: 'line',targetAxisIndex:1}}, vAxes:{1:{title:'Promedio',textStyle:{color: 'red'},pattern:'#,###%'}}
	                  };
	 
	            chart = new google.visualization.ComboChart(document.getElementById('form:chart_div'));
	
				//first arg to draw is an instance of chartData, the second are options 
				chart.draw(chartData, chartOptions);
			}

			function updateChart(){
				chartData = new google.visualization.DataTable();
				chartData.addRows(6);
				chartData.addColumn('string', 'codigo');
				chartData.addColumn('number', 'Demoras');
				chartData.addColumn('number', 'Promedio');
				
				var index = 0;
				var list = jQuery.parseJSON('#{reportBacking.graphData}');
				$.each(list, function(id, row) {
					chartData.setValue(index,0,row.label);
					chartData.setValue(index,1,row.value);
					index++;
				});	
			}
		</script>

	</ui:define>
</ui:composition>

</html>