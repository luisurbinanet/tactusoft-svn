<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/common.xhtml">

	<ui:define name="body">

		<p:panel style="width:100%;height:600px;"
			header="#{msg['title_case_study']}">

			<p:spacer height="5" />

			<h:form id="form">

				<p:toolbar style="width:100%">
					<p:toolbarGroup align="left">
						<p:commandButton value="#{msg['btn_new']}" icon="ui-icon-document"
							action="#{caseStudyBacking.newAction}" oncomplete="dlg.show()"
							update=":editForm:pnlDetail :editForm:dialog"
							disabled="#{caseStudyBacking.disabledNew}" />
					</p:toolbarGroup>
				</p:toolbar>

				<p:spacer height="10" />

				<p:dataTable id="recordTable" var="rec"
					value="#{caseStudyBacking.model}" rowKey="#{rec.id}"
					selection="#{caseStudyBacking.selected}" paginator="true" rows="10"
					style="width:100%" emptyMessage="#{msg['glb_no_records_found']}">

					<p:column selectionMode="single" style="width:18px" />

					<p:column headerText="#{msg['app_doctor']}">
						<h:outputLabel value="#{rec.crmDoctor.names}" />
					</p:column>

					<p:column headerText="#{msg['cam_pat']}">
						<h:outputLabel value="#{rec.crmPatient.names}" />
					</p:column>

					<p:column headerText="#{msg['cst_start_date']}">
						<h:outputLabel value="#{rec.startDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputLabel>
					</p:column>

					<p:column headerText="#{msg['cst_end_date']}">
						<h:outputLabel value="#{rec.endDate}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputLabel>
					</p:column>

					<p:column headerText="#{msg['cst_patology']}">
						<h:outputLabel value="#{rec.patology}" />
					</p:column>

					<p:column headerText="#{msg['cst_reason']}">
						<h:outputLabel value="#{rec.reason}" />
					</p:column>

					<p:column headerText="#{msg['cst_criteria']}">
						<h:outputLabel value="#{rec.criteria}" />
					</p:column>

				</p:dataTable>

			</h:form>

		</p:panel>

		<h:form id="editForm">

			<p:growl id="growl" showDetail="true" />

			<p:dialog header="#{msg['msg_detail']}" widgetVar="dlg"
				resizable="false" id="dialog" showEffect="fade" hideEffect="explode"
				modal="true" width="700" dynamic="true">

				<p:toolbar style="width:100%">
					<p:toolbarGroup align="left">
						<p:commandButton value="#{msg['btn_save']}" icon="ui-icon-disk"
							action="#{caseStudyBacking.saveAction}"
							update="growl :form:recordTable"
							oncomplete="handleComplete2(xhr, status, args)"
							rendered="#{caseStudyBacking.selected.id==null}" />
						<p:commandButton value="#{msg['btn_add_patient']}"
							icon="ui-icon-circle-check"
							actionListener="#{caseStudyBacking.newPatientAction}"
							oncomplete="dlgPatient.show()" update="pnlDetail"
							rendered="#{caseStudyBacking.selected.id==null}" process="@this" />
						<p:commandButton value="#{msg['btn_close']}"
							icon="ui-icon-closethick" update="growl :form:recordTable"
							process="@none" oncomplete="dlg.hide()" />
					</p:toolbarGroup>
				</p:toolbar>

				<p:spacer height="10" />

				<h:panelGrid id="pnlDetail" columns="2" cellpadding="4"
					style="margin:0 auto;" width="100%">

					<h:outputLabel
						value="#{caseStudyBacking.selectedPatient.contact?msg['pat_phone_number']:msg['pat_sap_code']}"
						rendered="#{caseStudyBacking.selectedPatient eq null?false:true}" />
					<p:inputText
						value="#{caseStudyBacking.selectedPatient.contact?caseStudyBacking.selectedPatient.phoneNumber:caseStudyBacking.selectedPatient.codeSap}"
						style="width:350px;background-color:#FFFF80;font-weight:bold;"
						readonly="true"
						rendered="#{caseStudyBacking.selectedPatient eq null?false:true}" />

					<h:outputLabel value="#{msg['pat_names']}"
						rendered="#{caseStudyBacking.selectedPatient eq null?false:true}" />
					<p:inputText value="#{caseStudyBacking.selectedPatient.names}"
						style="width:350px;background-color:#FFFF80;font-weight:bold;"
						readonly="true"
						rendered="#{caseStudyBacking.selectedPatient eq null?false:true}" />

					<p:outputLabel value="#{msg['cst_start_date']}" style="width:40%"
						for="calSD" />
					<p:calendar id="calSD" required="true"
						value="#{caseStudyBacking.selected.startDate}"
						label="#{msg['cst_start_date']}" readonlyInput="true"
						pattern="dd/MM/yyyy" showOn="button" navigator="true" locale="es" />

					<p:outputLabel value="#{msg['cst_end_date']}" style="width:40%"
						for="calED" />
					<p:calendar id="calED" value="#{caseStudyBacking.selected.endDate}"
						label="#{msg['cst_end_date']}" readonlyInput="true"
						required="true" pattern="dd/MM/yyyy" showOn="button"
						navigator="true" locale="es" />

					<p:outputLabel value="#{msg['cst_patology']}" for="txtPatology" />
					<h:inputTextarea id="txtPatology"
						value="#{caseStudyBacking.selected.patology}" style="width:100%"
						label="#{msg['cst_patology']}" rows="3" required="true" />

					<p:outputLabel value="#{msg['cst_reason']}" for="txtReason" />
					<h:inputTextarea id="txtReason"
						value="#{caseStudyBacking.selected.reason}" style="width:100%"
						label="#{msg['cst_reason']}" rows="3" required="true" />

					<h:outputLabel value="#{msg['cst_perc1']}" />
					<p:selectOneMenu value="#{caseStudyBacking.selected.perc1}">
						<f:selectItem itemValue="5" itemLabel="5%" />
						<f:selectItem itemValue="25" itemLabel="25%" />
						<f:selectItem itemValue="50" itemLabel="50%" />
						<f:selectItem itemValue="75" itemLabel="75%" />
						<f:selectItem itemValue="100" itemLabel="100%" />
					</p:selectOneMenu>

					<h:outputLabel value="#{msg['cst_perc2']}" />
					<p:selectOneMenu value="#{caseStudyBacking.selected.perc2}">
						<f:selectItem itemValue="5" itemLabel="5%" />
						<f:selectItem itemValue="25" itemLabel="25%" />
						<f:selectItem itemValue="50" itemLabel="50%" />
						<f:selectItem itemValue="75" itemLabel="75%" />
						<f:selectItem itemValue="100" itemLabel="100%" />
					</p:selectOneMenu>

					<h:outputLabel value="#{msg['cst_perc3']}" />
					<p:selectOneMenu value="#{caseStudyBacking.selected.perc3}">
						<f:selectItem itemValue="5" itemLabel="5%" />
						<f:selectItem itemValue="25" itemLabel="25%" />
						<f:selectItem itemValue="50" itemLabel="50%" />
						<f:selectItem itemValue="75" itemLabel="75%" />
						<f:selectItem itemValue="100" itemLabel="100%" />
					</p:selectOneMenu>

					<h:outputLabel value="#{msg['cst_perc4']}" />
					<p:selectOneMenu value="#{caseStudyBacking.selected.perc4}">
						<f:selectItem itemValue="5" itemLabel="5%" />
						<f:selectItem itemValue="25" itemLabel="25%" />
						<f:selectItem itemValue="50" itemLabel="50%" />
						<f:selectItem itemValue="75" itemLabel="75%" />
						<f:selectItem itemValue="100" itemLabel="100%" />
					</p:selectOneMenu>

					<p:outputLabel value="#{msg['cst_criteria']}" for="txtCriteria" />
					<h:inputTextarea id="txtCriteria"
						value="#{caseStudyBacking.selected.criteria}" style="width:100%"
						label="#{msg['cst_criteria']}" rows="3" required="true" />

				</h:panelGrid>

			</p:dialog>

			<p:dialog header="#{msg['sal_patient']}" widgetVar="dlgPatient"
				resizable="false" id="dialogPatient" showEffect="fade"
				hideEffect="explode" modal="true" width="600">

				<h:panelGrid columns="2" width="100%">

					<p:outputPanel id="customPanel">
						<p:selectOneRadio id="customRadio"
							value="#{caseStudyBacking.optionSearchPatient}" layout="custom">
							<f:selectItem itemLabel="#{msg['sal_key_press_doc']}"
								itemValue="1" />
							<f:selectItem itemLabel="#{msg['sal_key_press_nom']}"
								itemValue="2" />
						</p:selectOneRadio>

						<h:panelGrid columns="2" width="100%" cellspacing="10">
							<h:outputText value="#{msg['usr_profile']}" />
							<p:selectOneMenu value="#{caseStudyBacking.idProfile}"
								style="width:500px" required="true"
								label="#{msg['usr_profile']}">
								<f:selectItems value="#{caseStudyBacking.listProfile}" />
							</p:selectOneMenu>
						</h:panelGrid>

						<h:panelGrid id="pnlTxt" columns="3" width="100%">
							<p:radioButton id="opt1" for="customRadio" itemIndex="0" />
							<h:outputLabel for="opt1" value="#{msg['sal_key_press_doc']}" />
							<p:inputText id="txtDoc" value="#{caseStudyBacking.docPatient}"
								style="width:100%" />

							<p:radioButton id="opt2" for="customRadio" itemIndex="1" />
							<h:outputLabel for="opt2" value="#{msg['sal_key_press_nom']}" />
							<p:inputText id="txtName" value="#{caseStudyBacking.namePatient}"
								style="width:100%" />

						</h:panelGrid>
					</p:outputPanel>

					<f:facet name="footer">
						<p:spacer height="10" />

						<p:commandButton value="#{msg['btn_search']}"
							icon="ui-icon-search"
							update="pnlTable2 recordTable2 btnAddPatient"
							process="@this,customPanel"
							action="#{caseStudyBacking.searchPatientAction}" />
						<p:commandButton id="btnAddPatient" value="#{msg['btn_add']}"
							icon="ui-icon-plusthick" update=":editForm:pnlDetail"
							oncomplete="handleComplete(xhr, status, args)"
							actionListener="#{caseStudyBacking.addPatient}"
							process="@this,dialogPatient"
							disabled="#{caseStudyBacking.disabledAddPatient}" />
					</f:facet>
				</h:panelGrid>

				<p:spacer height="10" />
				<p:scrollPanel id="pnlTable2" style="width:580px;height:300px">
					<p:dataTable id="recordTable2" var="rec"
						value="#{caseStudyBacking.patientModel}" rowKey="#{rec.id}"
						selection="#{caseStudyBacking.selectedPatientTemp}"
						paginator="true" rows="15" style="width:570px"
						emptyMessage="#{msg['glb_no_records_found']}">

						<p:column selectionMode="single" style="width:18px" />

						<p:column headerText="#{msg['pat_sap_code']}">
							<h:outputLabel value="#{rec.codeSap}" />
						</p:column>

						<p:column headerText="#{msg['pat_names']}">
							<h:outputLabel value="#{rec.names}" />
						</p:column>

					</p:dataTable>
				</p:scrollPanel>

			</p:dialog>
		</h:form>

		<script type="text/javascript">
			function handleComplete(xhr, status, args) {
				if (args.validate) {
					dlgPatient.hide();
				} else {
					dialogPatient.show();
				}
			}

			function handleComplete2(xhr, status, args) {
				if (args.validate) {
					dlg.hide();
				}
			}
		</script>

	</ui:define>
</ui:composition>
</html>
