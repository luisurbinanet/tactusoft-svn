<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../layout/main.xhtml">
	<ui:define name="content">

		<div class="rco-blockheader">
			<div class="l"></div>
			<div class="r"></div>
			<div class="t">#{msg['title_week']}</div>
		</div>

		<p:spacer height="20" />

		<h:form id="form">

			<p:dataTable id="recordTable" var="rec"
				value="#{kpiWeekBacking.model}" rowKey="#{rec.id}"
				selectionMode="single" selection="#{kpiWeekBacking.selected}"
				paginator="true" rows="20">

				<p:ajax event="rowSelect" update=":editForm:dialogPanel"
					oncomplete="dialogPanel.show()" />

				<p:column headerText="#{msg['wek_name']}">#{rec.name}</p:column>

				<p:column headerText="#{msg['wek_assigned_orders']}">#{rec.assignedOrders}</p:column>

				<p:column headerText="#{msg['wek_star_date']}">
					<h:outputLabel value="#{rec.startDate}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputLabel>
				</p:column>

				<p:column headerText="#{msg['wek_end_date']}">
					<h:outputLabel value="#{rec.endDate}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputLabel>
				</p:column>

				<p:column headerText="#{msg['glb_state']}">#{rec.state == 40?msg['wek_state_40']:msg['wek_state_60']}</p:column>

			</p:dataTable>

			<p:spacer height="10" />

			<h:panelGrid columns="2" style="align='left'">
				<p:commandButton id="cmdNew" action="#{kpiWeekBacking.newAction}"
					update=":editForm:dialogPanel" icon="ui-icon-plusthick"
					value="#{msg['btn_new']}" oncomplete="dialogPanel.show()" />
			</h:panelGrid>

			<p:spacer height="10" />
		</h:form>

		<h:form id="editForm" prependId="false">

			<p:dialog id="dialogPanel"
				header="#{msg['msg_record_selected']} #{kpiWeekBacking.selected.name}"
				widgetVar="dialogPanel" resizable="false" modal="false" width="400">

				<p:growl id="growl" showDetail="true" />

				<h:panelGrid id="display" columns="2" width="100%">

					<h:outputText value="#{msg['wek_assigned_orders']}" />
					<p:spinner value="#{kpiWeekBacking.selected.assignedOrders}"
						min="1" max="999" maxlength="3">
						<f:validator validatorId="workOrderValidator" />
						<f:attribute name="fieldLabel" value="OT Programadas" />
					</p:spinner>

					<h:outputText value="#{msg['wek_star_date']}" />
					<p:calendar value="#{kpiWeekBacking.selected.startDate}"
						showOn="button" navigator="true" />

					<h:outputText value="#{msg['glb_state']}" />
					<p:selectOneMenu value="#{kpiWeekBacking.selected.state}"
						style="width:100%">
						<f:selectItem itemValue="40" itemLabel="#{msg['wek_state_40']}" />
						<f:selectItem itemValue="60" itemLabel="#{msg['wek_state_60']}" />
					</p:selectOneMenu>

				</h:panelGrid>

				<f:facet name="footer">
					<p:commandButton id="cmdSave" action="#{kpiWeekBacking.saveAction}"
						update=":form:recordTable :editForm:display growl"
						icon="ui-icon-disk" value="#{msg['btn_save']}"
						oncomplete="handleSubmitRequest(xhr, status, args);" />
				</f:facet>
			</p:dialog>

		</h:form>

		<p:spacer height="200" />

		<script type="text/javascript">  
	         function handleSubmitRequest(xhr, status, args) {  
	             if(args.saved!='true') {  
	                 jQuery('#dialogPanel').effect("shake", { times:1 }, 50);   
	             } else {                                      
	             	dialogPanel.hide();   
	             }
	         }
        </script>

	</ui:define>
</ui:composition>

</html>