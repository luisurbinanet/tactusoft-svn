<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../layout/main.xhtml">

	<ui:define name="title">
		#{msg['title_schedule_days']}
	</ui:define>

	<ui:define name="content">

		<p:spacer height="10" />

		<h:form id="form">

			<p:panel width="100%">
				<h:panelGrid id="pnlCalendarWeeks" columns="2" width="100%">
					<h:outputText value="#{msg['day_calendar_week']}"
						style="width:100%" />
					<p:selectOneMenu value="#{kpiDailyBacking.kpiWeekSelected}"
						style="width:420px">
						<f:selectItems value="#{kpiDailyBacking.listCalendarWeeks}" />
						<p:ajax update="recordTable"
							listener="#{kpiDailyBacking.handleWeekChange}" />
					</p:selectOneMenu>
				</h:panelGrid>
			</p:panel>

			<p:spacer height="10" />

			<p:dataTable id="recordTable" var="rec"
				value="#{kpiDailyBacking.model}" rowKey="#{rec.id}"
				selectionMode="single" selection="#{kpiDailyBacking.selected}"
				paginator="true" rows="20">

				<p:ajax event="rowSelect" update=":editForm:display"
					oncomplete="dlgPanel.show()" />

				<p:column headerText="#{msg['day_day']}">
					<h:outputLabel value="#{rec.currentDay}">
						<f:convertDateTime pattern="dd/MM/yyyy" />
					</h:outputLabel>
				</p:column>

				<p:column headerText="#{msg['day_wo_scheduled']}">#{rec.scheduledOrders}</p:column>

				<p:column headerText="#{msg['day_wo_finished']}">#{rec.finishedOrders}</p:column>

				<p:column headerText="#{msg['day_wo_failures']}">#{rec.failuresOrders}</p:column>

				<p:column headerText="#{msg['day_wo_indentified_work']}">#{rec.identifiedWork}</p:column>

				<p:column headerText="#{msg['day_wo_founded_work']}">#{rec.foundWork}</p:column>

				<p:column headerText="#{msg['glb_state']}">#{rec.state == 1?msg['glb_state_open']:msg['glb_state_close']}</p:column>

			</p:dataTable>

			<p:spacer height="10" />

			<h:panelGrid columns="2" style="align='left'">
				<p:commandButton id="cmdNew" action="#{kpiDailyBacking.newAction}"
					icon="ui-icon-plusthick" value="#{msg['btn_new']}"
					update=":editForm:dialogPanel" oncomplete="dlgPanel.show()" />
			</h:panelGrid>

			<p:spacer height="10" />

		</h:form>

		<h:form id="editForm" prependId="false">
			<p:dialog id="dialogPanel"
				header="#{msg['msg_record_selected']} #{kpiWeekBacking.selected.name}"
				widgetVar="dlgPanel" resizable="false" modal="true" width="500">

				<p:growl id="growl" showDetail="true" />

				<h:panelGrid id="display" columns="2" width="100%">

					<h:outputText value="#{msg['day_day']}" />
					<p:calendar id="currentDay"
						value="#{kpiDailyBacking.selected.currentDay}" showOn="button"
						navigator="true" mindate="#{kpiDailyBacking.minDate}"
						maxdate="#{kpiDailyBacking.maxDate}"
						disabled="#{kpiDailyBacking.selected.id == null?false:true}" />

					<h:outputText value="#{msg['day_wo_scheduled']}" />
					<p:spinner value="#{kpiDailyBacking.selected.scheduledOrders}"
						min="1" max="999" maxlength="3">
						<f:validator validatorId="workOrderValidator" />
						<f:attribute name="fieldLabel" value="OT Asignadas" />
					</p:spinner>

					<h:outputText value="#{msg['glb_state']}"
						rendered="#{kpiDailyBacking.selected.id == null?false:true}" />
					<p:selectOneMenu value="#{kpiDailyBacking.selected.state}"
						rendered="#{kpiDailyBacking.selected.id == null?false:true}">
						<f:selectItem itemLabel="#{msg['glb_state_open']}" itemValue="1" />
						<f:selectItem itemLabel="#{msg['glb_state_close']}" itemValue="0" />
					</p:selectOneMenu>

				</h:panelGrid>

				<f:facet name="footer">
					<p:commandButton id="cmdSave"
						action="#{kpiDailyBacking.saveAction}"
						update=":form:recordTable :editForm:display growl"
						icon="ui-icon-disk" value="#{msg['btn_save']}" process="@form"
						oncomplete="handleSubmitRequest(xhr, status, args);">
						<f:setPropertyActionListener target="#{kpiDailyBacking.pageType}"
							value="daily" />
					</p:commandButton>
				</f:facet>
			</p:dialog>


			<p:spacer height="200" />
		</h:form>

		<script type="text/javascript">  
	         function handleSubmitRequest(xhr, status, args) {  
	             if(args.saved!='true') {  
	                 jQuery('#dialogPanel').effect("shake", { times:1 }, 50);   
	             } else {                                      
	            	 dlgPanel.hide();   
	             }
	         }
        </script>
	</ui:define>
</ui:composition>

</html>