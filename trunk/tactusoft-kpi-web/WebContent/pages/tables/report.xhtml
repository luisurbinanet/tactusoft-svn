<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../layout/main.xhtml">
	
	<ui:define name="content">

		<div class="rco-blockheader">
			<div class="l"></div>
			<div class="r"></div>
			<div class="t">#{msg['title_report_daymonth']}</div>
		</div>

		<div id="content2">
			<h:form id="form">

				<p:panel width="100%">
					<h:panelGrid id="pnlParameter" columns="2" width="100%">
						<h:outputText value="#{msg['wos_calendar_week']}"
							style="width:100%" />
						<p:selectOneMenu value="#{reportBacking.idKpiWeek}"
							style="width:430px">
							<f:selectItems value="#{reportBacking.listItemWeeks}" />
						</p:selectOneMenu>
					</h:panelGrid>

					<f:facet name="footer">
						<p:commandButton id="cmdOK" update="display"
							value="#{msg['btn_ok']}"
							actionListener="#{reportBacking.generateAction}" oncomplete="drawVisualization();">
							<f:ajax event="change" render="chart_div"/>
						</p:commandButton>
					</f:facet>

				</p:panel>

				<p:spacer height="10" />

				<h:panelGrid id="display" width="100%">
					<p:dataTable id="recordTable" var="rec"
						value="#{reportBacking.model}">

						<p:column headerText="Daily Metrics">
							<h:outputLabel value="#{rec.metric}" />
						</p:column>

						<p:column headerText="UM">
							<h:outputLabel value="#{rec.um}" />
						</p:column>

						<p:column headerText="">
							<h:outputLabel value="#{rec.type}" />
						</p:column>

						<p:columns value="#{reportBacking.columns}" var="column"
							columnIndexVar="colIndex">

							<f:facet name="header">
                				#{column.header}
            				</f:facet>

							<h:outputLabel value="#{rec.listPlan[colIndex]}"
								rendered="#{rec.um eq '%'?true:false}"
								styleClass="#{rec.style[colIndex]}">
								<f:convertNumber type="percent" />
							</h:outputLabel>

							<h:outputLabel value="#{rec.listPlan[colIndex]}"
								rendered="#{rec.um eq '%'?false:true}"
								styleClass="#{rec.style[colIndex]}">
								<f:convertNumber type="number" />
							</h:outputLabel>

						</p:columns>

					</p:dataTable>

					<p:spacer height="10" />

					<h:panelGroup id="chart_div" style="width: 100%; height: 450px;"
						layout="block" />

				</h:panelGrid>

			</h:form>

		</div>

		<script type="text/javascript">
          google.load('visualization', '1', {packages: ['corechart']});
 
          function drawVisualization() {
            var data = new google.visualization.DataTable();
            <h:outputFormat value="#{reportBacking.graphData}"/>

            var options = {
                    title : 'Demoras del Dia Anterior',
                    vAxis: {title: "Horas"},
                    hAxis: {title: ""},
                    seriesType: "bars",
                    series: {5: {type: "line"}}
                  };
 
            var chart = new google.visualization.ComboChart(document.getElementById('form:chart_div'));
            chart.draw(data, options);
          }

          function handleLoginRequest(xhr, status, args) {
         	 drawVisualization();
          }
 
          google.setOnLoadCallback(drawVisualization);
		</script>

	</ui:define>
</ui:composition>

</html>